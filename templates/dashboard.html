{% extends "base.html" %}

{% block content %}
    <div id="search-container">
        <input type="text" id="search-box" placeholder="Listene eklemek için ara...">
        <div id="search-results"></div>
    </div>

    <div id="filter-container">
        <button class="filter-btn active" data-status="all">Tüm Kayıtlar</button>
        <button class="filter-btn" data-status="Okunuyor">Okunuyor</button>
        <button class="filter-btn" data-status="Tamamlandı">Tamamlandı</button>
        <button class="filter-btn" data-status="Planlandı">Planlandı</button>
        <button class="filter-btn" data-status="Bırakıldı">Bırakıldı</button>
    </div>

    <div id="user-list-container">
        {% for item in user_list %}
            <div class="manhwa-card"
                 data-user-list-id="{{ item.list_item.id }}"
                 data-status="{{ item.list_item.status }}"
                 data-chapter="{{ item.list_item.current_chapter }}"
                 data-notes="{{ item.list_item.notes or '' }}"
                 data-record-title="{{ item.record.original_title }}">
                <div class="card-image-wrapper">
                    <img src="{{ item.record.image_url or 'https://via.placeholder.com/250x350.png?text=Yok' }}" class="card-image" loading="lazy">
                </div>
                <div class="card-title">{{ item.record.original_title }}</div>
                <div class="card-progress">
                    <span>Bölüm: {{ item.list_item.current_chapter }}</span>
                    <span class="status-badge status-{{ item.list_item.status.lower()|replace('ı','-')|replace('ğ','-')|replace('ş','-') }}">{{ item.list_item.status }}</span>
                </div>
            </div>
        {% else %}
            <p>Listen henüz boş. Arama yaparak yeni kayıtlar ekleyebilirsin!</p>
        {% endfor %}
    </div>

    <div id="update-item-modal" class="modal">
        <div class="modal-content">
            <span id="close-update-modal-btn" class="close-btn">&times;</span>
            <h2 id="update-modal-title">Kaydı Güncelle</h2>
            <form id="update-item-form">
                <input type="hidden" id="user-list-id-input">
                <div class="form-group">
                    <label for="status-input">Durum:</label>
                    <select id="status-input" name="status">
                        <option value="Okunuyor">Okunuyor</option>
                        <option value="Tamamlandı">Tamamlandı</option>
                        <option value="Planlandı">Planlandı</option>
                        <option value="Bırakıldı">Bırakıldı</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="chapter-input">Okunan Bölüm:</label>
                    <input type="number" id="chapter-input" name="chapter" min="0">
                </div>
                <div class="form-group">
                    <label for="notes-input">Kişisel Notlar:</label>
                    <textarea id="notes-input" name="notes" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Güncelle</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}